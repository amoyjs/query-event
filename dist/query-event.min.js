!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@amoy/common")):"function"==typeof define&&define.amd?define(["exports","@amoy/common"],n):n((t=t||self).queryEvent={},t.common)}(this,function(t,r){"use strict";var i=(n.prototype.add=function(t){return this.handlers.push(t),this},n.prototype.del=function(i){var e=this;return i?this.handlers.map(function(t,n){t===i&&e.handlers.splice(n,1)}):this.handlers=[],this},n.prototype.fire=function(n,i){if(this.handlers&&this.handlers.length)return this.handlers.map(function(t){"function"==typeof t&&t.bind(i)(n)}),this},n.prototype.clear=function(){this.handlers=[]},n);function n(){this.handlers=[]}var g={getCurTargetByEv:function(t,n){var i,e=0;if(r.getValue(t,"children.length")&&t.children.map(function(t){t.containsPoint&&t.containsPoint(n.data.global)&&t.zIndex>=e&&(e=(i=t).zIndex)}),i){var o=g.getCurTargetByEv(i,n);o&&(i=o)}return i||t},getFingers:function(t){return r.getValue(t,"data.originalEvent.touches.length")||1},getPoint:function(t,n){if("touch"!==t.data.pointerType)return{x:Math.round(t.data.global.x),y:Math.round(t.data.global.y)};var i=t.data.originalEvent.touches;return{x:Math.round(i[n].pageX),y:Math.round(i[n].pageY)}},getVector:function(t,n){return{x:Math.round(t.x-n.x),y:Math.round(t.y-n.y)}},getLength:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},getAngle:function(t,n){if("object"==typeof t&&"object"==typeof n){var i,e=0<t.x*n.y-n.x*t.y?1:-1,o=this.getLength(t)*this.getLength(n);return 0==o?0:(1<(i=(t.x*n.x+t.y*n.y)/o)&&(i=1),i<-1&&(i=-1),Math.acos(i)*e)}console.error("getAngle error!")},getAnchorPoint:function(t){return{x:t.x,y:t.y}}},e=["touchstart","touchmove","touchend","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotate","rotatestart","rotateend","swipeleft","swiperight","swipeup","swipedown","shorttap","longtap","singlepinch","singlepinchstart","singlepinchend","singlerotate","singlerotatestart","singlerotateend"],o=[{name:"pointerdown",fn:"_start"},{name:"pointermove",fn:"_move"},{name:"pointerup",fn:"_end"},{name:"pointerupoutside",fn:"_end"}],s=(a.prototype.initEventBus=function(){var n=this;e.map(function(t){Object.defineProperty(n.Bus,t,{value:new i})})},a.prototype.bindOriginEvent=function(){var e=this;o.map(function(t){var n=t.name,i=t.fn;e.target.interactive=!0,e.target.on(n,e[i],e)})},a.prototype._start=function(t){var n=this;this.touching=!0,this.startTime=Date.now(),this.fingers=g.getFingers(t),this.swipeStartPoint=this.startPoint=g.getPoint(t,0),this.singleBasePoint=g.getAnchorPoint(this.target);var i=g.getCurTargetByEv(t.target,t);if(this.isSingleButton=i&&"singlebutton"===i.name,1===this.fingers){var e=g.getVector(this.startPoint,this.singleBasePoint);this.singlePinchStartLength=g.getLength(e)}else 1<this.fingers&&(this.secondPoint=g.getPoint(t,1),this.vector1=g.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=g.getLength(this.vector1));this.longtapTimer=setTimeout(function(){n.fireEvent("longtap",{origin:t}),n.longtapTimer=null},1e3),this.fireEvent("touchstart",{origin:t})},a.prototype._move=function(t){if(this.touching){var n=g.getPoint(t,0);if(this.startPoint||(this.startPoint=n),1<this.fingers){var i=g.getPoint(t,1),e=g.getVector(i,n),o=g.getLength(e);this.pinchStartLength&&(this.eventStart("pinch",{origin:t,delta:{scale:o/this.pinchStartLength}}),this.pinchStartLength=o),this.vector1&&(this.eventStart("rotate",{delta:{rotate:g.getAngle(this.vector1,e)},origin:t}),this.vector1=e)}else{if(this.isSingleButton){var r=g.getVector(n,this.singleBasePoint),s=g.getLength(r);this.eventStart("singlepinch",{delta:{scale:s/this.singlePinchStartLength,deltaX:n.x-this.startPoint.x,deltaY:n.y-this.startPoint.y},origin:t}),this.singlePinchStartLength=s}if(this.isSingleButton){var a=g.getVector(this.startPoint,this.singleBasePoint),h=g.getVector(n,this.singleBasePoint);this.eventStart("singlerotate",{delta:{rotate:g.getAngle(a,h)},origin:t})}}this.eventStart("drag",{delta:{x:n.x-this.startPoint.x,y:n.y-this.startPoint.y},origin:t}),this.fireEvent("touchmove",{origin:t}),this.startPoint=n}},a.prototype._end=function(n){var i=this;if(this.touching=!1,this.fingers=g.getFingers(n),["pinch","drag","rotate","singlerotate","singlepinch"].map(function(t){i.eventEnd(t,{origin:n,type:t})}),this.swipeStartPoint){var t=Math.round(n.data.global.x),e=Math.round(n.data.global.y),o=t-this.swipeStartPoint.x,r=e-this.swipeStartPoint.y,s=Date.now(),a="";30<o&&Math.abs(r)<100?a="swiperight":o<-30&&Math.abs(r)<100?a="swipeleft":30<r&&Math.abs(o)<100?a="swipedown":r<-30&&Math.abs(o)<100?a="swipeup":Math.abs(o)<30&&Math.abs(r)<30&&s-this.startTime<500&&(a="shorttap"),a&&this.fireEvent(a,{origin:n})}this.fireEvent("touchend",{origin:n}),this.longtapTimer&&clearTimeout(this.longtapTimer)},a.prototype.fireEvent=function(t,n){this.Bus[t]&&this.Bus[t].fire(Object.assign(n,{type:t,stopPropagation:function(){n.origin.stopPropagation()}}),this.target)},a.prototype.destory=function(){var e=this;o.map(function(t){var n=t.name,i=t.fn;e.target.off(n,e[i],e)})},a.prototype.eventStart=function(t,n){var i=t+"ing",e=t+"start";this[i]?this.fireEvent(t,n):(this.fireEvent(e,n),this[i]=!0)},a.prototype.eventEnd=function(t,n){var i=t+"ing",e=t+"end";this[i]&&(n.type=e,this.fireEvent(e,n),this[i]=!1)},a.prototype.on=function(t,n){var i=this;return t.trim().toLowerCase().split(" ").map(function(t){i.Bus[t].add(n)}),this},a.prototype.off=function(t,n){var i=this;return t.trim().toLowerCase().split(" ").map(function(t){n?i.Bus[t].del(n):i.Bus[t].clear()}),this},a);function a(t){this.fingers=0,this.touching=!1,this.isSingleButton=!1,this.Bus={},this.target=t,this.initEventBus(),this.bindOriginEvent()}function h(t,n,i){return e.includes(n)?(t.RTouch||(t.RTouch=new s(t)),t.RTouch.on(n,i)):(t.interactive=!0,t.on(n,i)),t}function u(t,n,i){return e.includes(n)&&t.RTouch?t.RTouch.off(n,i):(t.interactive=!0,t.off(n,i)),t}var c={on:function(t,n){void 0===t&&(t=""),void 0===n&&(n=function(){});for(var i=t.split(" "),e=0;e<this.length;e++)for(var o=0;o<i.length;o++)this[e].interactive=!0,h(this[e],i[o],n);return this},off:function(t){void 0===t&&(t="");for(var n=t.split(" "),i=0;i<this.length;i++)for(var e=0;e<n.length;e++)this[i].off(n[e]),u(this[i],n[e]);return this}};t.RTOUCH_SUPPORT_EVENT=e,t.default=c,t.off=u,t.on=h,t.queryEvent=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=query-event.min.js.map
